## Step 4.6: Create Real-time Approval Updates

- **Task**: Implement real-time updates for the approval queue using Supabase Realtime.

- **Files**:

### `hooks/use-approval-realtime.ts`
```typescript
import { useEffect } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { getSupabaseBrowserClient } from '@/lib/supabase/client';
import { useToast } from '@/components/providers/toast-provider';

export function useApprovalRealtime(userId: string | undefined) {
  const queryClient = useQueryClient();
  const { toast } = useToast();
  const supabase = getSupabaseBrowserClient();

  useEffect(() => {
    if (!userId) return;

    const channel = supabase
      .channel('approval-changes')
      .on(
        'postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table: 'approval_items',
          filter: `user_id=eq.${userId}`,
        },
        (payload) => {
          // New item added to queue
          queryClient.invalidateQueries({ queryKey: ['approvals'] });
          queryClient.invalidateQueries({ queryKey: ['approval-counts'] });
          
          const item = payload.new as { type: string };
          toast(`New ${item.type} ready for review`, 'info');
        }
      )
      .on(
        'postgres_changes',
        {
          event: 'UPDATE',
          schema: 'public',
          table: 'approval_items',
          filter: `user_id=eq.${userId}`,
        },
        (payload) => {
          // Item status changed (possibly by another tab/device)
          const newStatus = (payload.new as { status: string }).status;
          if (newStatus !== 'pending') {
            queryClient.invalidateQueries({ queryKey: ['approvals'] });
            queryClient.invalidateQueries({ queryKey: ['approval-counts'] });
          }
        }
      )
      .on(
        'postgres_changes',
        {
          event: 'DELETE',
          schema: 'public',
          table: 'approval_items',
          filter: `user_id=eq.${userId}`,
        },
        () => {
          queryClient.invalidateQueries({ queryKey: ['approvals'] });
          queryClient.invalidateQueries({ queryKey: ['approval-counts'] });
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId, supabase, queryClient, toast]);
}
```

### Update `components/approval-queue/approval-queue-list.tsx` to use realtime

Add at the top of the component:
```typescript
import { useAuthContext } from '@/contexts/auth-context';
import { useApprovalRealtime } from '@/hooks/use-approval-realtime';

// Inside the component:
export function ApprovalQueueList() {
  const { user } = useAuthContext();
  
  // Enable real-time updates
  useApprovalRealtime(user?.id);
  
  // ... rest of the component
}
```

- **Step Dependencies**: Step 4.5
- **User Instructions**: Enable Realtime in Supabase Dashboard → Database → Replication

---

**Part 4 Summary**

This part completes:

**Phase 3 (Operator Mode - Steps 3.3-3.6):**
- Mode selector dropdown with grace period handling
- Mode details panel showing approval requirements by module
- Guardrails editor with validation and usage indicators
- Module overrides configuration
- Activity log component
- Complete operator mode settings page

**Phase 4 (Approval Queue - Steps 4.1-4.6):**
- Database schema with polymorphic approval items
- API endpoints for fetching, single actions, and bulk operations
- Custom hook for approval queue data and mutations
- Approval queue list with filtering, selection, keyboard navigation
- Type-specific approval item cards with previews and actions
- Empty state with mode-aware messaging
- Real-time updates via Supabase Realtime

---

**Next: Part 5 will cover Phase 5 (Setup Wizard & Integrations), Phase 6 (Error Management & Exports), Phase 7 (Design System Foundation), and Phase 8 (Design Engine Pipeline)**
