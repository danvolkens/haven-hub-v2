## Step 14.4: Build Landing Page Builder UI

- **Task**: Create the drag-and-drop landing page builder interface with block components.

- **Files**:

### `components/landing-pages/builder/block-types.ts`
```typescript
export type BlockType = 
  | 'hero'
  | 'text'
  | 'image'
  | 'cta'
  | 'quiz_embed'
  | 'product_grid'
  | 'testimonial'
  | 'faq'
  | 'countdown'
  | 'email_capture';

export interface BlockConfig {
  type: BlockType;
  label: string;
  icon: string;
  defaultContent: Record<string, any>;
}

export const BLOCK_CONFIGS: BlockConfig[] = [
  {
    type: 'hero',
    label: 'Hero Section',
    icon: 'Layout',
    defaultContent: {
      headline: 'Your Headline Here',
      subheadline: 'Add a compelling subheadline',
      backgroundImage: null,
      ctaText: 'Get Started',
      ctaLink: '#',
      alignment: 'center',
    },
  },
  {
    type: 'text',
    label: 'Text Block',
    icon: 'Type',
    defaultContent: {
      content: '<p>Your content here...</p>',
      alignment: 'left',
    },
  },
  {
    type: 'image',
    label: 'Image',
    icon: 'Image',
    defaultContent: {
      src: null,
      alt: '',
      caption: '',
      width: 'full',
    },
  },
  {
    type: 'cta',
    label: 'Call to Action',
    icon: 'MousePointer',
    defaultContent: {
      text: 'Click Here',
      link: '#',
      style: 'primary',
      size: 'large',
    },
  },
  {
    type: 'quiz_embed',
    label: 'Quiz Embed',
    icon: 'HelpCircle',
    defaultContent: {
      quizId: null,
      showTitle: true,
    },
  },
  {
    type: 'product_grid',
    label: 'Product Grid',
    icon: 'Grid',
    defaultContent: {
      collection: null,
      columns: 3,
      limit: 6,
      showPrices: true,
    },
  },
  {
    type: 'testimonial',
    label: 'Testimonial',
    icon: 'Quote',
    defaultContent: {
      quote: 'Add a customer testimonial here',
      author: 'Customer Name',
      role: 'Happy Customer',
      avatar: null,
    },
  },
  {
    type: 'email_capture',
    label: 'Email Capture',
    icon: 'Mail',
    defaultContent: {
      headline: 'Join our newsletter',
      description: 'Get updates and special offers',
      buttonText: 'Subscribe',
      klaviyoListId: null,
    },
  },
  {
    type: 'countdown',
    label: 'Countdown Timer',
    icon: 'Clock',
    defaultContent: {
      endDate: null,
      expiredText: 'Offer has ended',
      style: 'minimal',
    },
  },
  {
    type: 'faq',
    label: 'FAQ Section',
    icon: 'HelpCircle',
    defaultContent: {
      title: 'Frequently Asked Questions',
      items: [
        { question: 'Question 1?', answer: 'Answer 1' },
        { question: 'Question 2?', answer: 'Answer 2' },
      ],
    },
  },
];

export interface ContentBlock {
  id: string;
  type: BlockType;
  content: Record<string, any>;
  order: number;
}
```

### `components/landing-pages/builder/page-builder.tsx`
```tsx
'use client';

import { useState, useCallback } from 'react';
import {
  DndContext,
  closestCenter,
  KeyboardSensor,
  PointerSensor,
  useSensor,
  useSensors,
  DragEndEvent,
} from '@dnd-kit/core';
import {
  arrayMove,
  SortableContext,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from '@dnd-kit/sortable';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { BlockPalette } from './block-palette';
import { BuilderCanvas } from './builder-canvas';
import { BlockEditor } from './block-editor';
import { BLOCK_CONFIGS, ContentBlock, BlockType } from './block-types';
import { Eye, Save, Settings, Smartphone, Monitor } from 'lucide-react';
import { nanoid } from 'nanoid';

interface PageBuilderProps {
  initialBlocks?: ContentBlock[];
  onSave: (blocks: ContentBlock[]) => Promise<void>;
  pageSettings: Record<string, any>;
  onSettingsChange: (settings: Record<string, any>) => void;
}

export function PageBuilder({
  initialBlocks = [],
  onSave,
  pageSettings,
  onSettingsChange,
}: PageBuilderProps) {
  const [blocks, setBlocks] = useState<ContentBlock[]>(initialBlocks);
  const [selectedBlockId, setSelectedBlockId] = useState<string | null>(null);
  const [previewMode, setPreviewMode] = useState<'desktop' | 'mobile'>('desktop');
  const [isSaving, setIsSaving] = useState(false);

  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  const selectedBlock = blocks.find(b => b.id === selectedBlockId);

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;

    if (over && active.id !== over.id) {
      setBlocks((items) => {
        const oldIndex = items.findIndex(i => i.id === active.id);
        const newIndex = items.findIndex(i => i.id === over.id);
        return arrayMove(items, oldIndex, newIndex).map((block, idx) => ({
          ...block,
          order: idx,
        }));
      });
    }
  };

  const addBlock = useCallback((type: BlockType) => {
    const config = BLOCK_CONFIGS.find(c => c.type === type);
    if (!config) return;

    const newBlock: ContentBlock = {
      id: nanoid(),
      type,
      content: { ...config.defaultContent },
      order: blocks.length,
    };

    setBlocks(prev => [...prev, newBlock]);
    setSelectedBlockId(newBlock.id);
  }, [blocks.length]);

  const updateBlock = useCallback((id: string, content: Record<string, any>) => {
    setBlocks(prev =>
      prev.map(block =>
        block.id === id ? { ...block, content } : block
      )
    );
  }, []);

  const deleteBlock = useCallback((id: string) => {
    setBlocks(prev => prev.filter(block => block.id !== id));
    if (selectedBlockId === id) {
      setSelectedBlockId(null);
    }
  }, [selectedBlockId]);

  const duplicateBlock = useCallback((id: string) => {
    const block = blocks.find(b => b.id === id);
    if (!block) return;

    const newBlock: ContentBlock = {
      ...block,
      id: nanoid(),
      order: blocks.length,
    };

    setBlocks(prev => [...prev, newBlock]);
    setSelectedBlockId(newBlock.id);
  }, [blocks]);

  const handleSave = async () => {
    setIsSaving(true);
    try {
      await onSave(blocks);
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <div className="h-screen flex flex-col">
      {/* Toolbar */}
      <div className="border-b bg-white px-4 py-2 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Button
            variant={previewMode === 'desktop' ? 'default' : 'ghost'}
            size="sm"
            onClick={() => setPreviewMode('desktop')}
          >
            <Monitor className="h-4 w-4" />
          </Button>
          <Button
            variant={previewMode === 'mobile' ? 'default' : 'ghost'}
            size="sm"
            onClick={() => setPreviewMode('mobile')}
          >
            <Smartphone className="h-4 w-4" />
          </Button>
        </div>

        <div className="flex items-center gap-2">
          <Button variant="outline" size="sm">
            <Eye className="h-4 w-4 mr-2" />
            Preview
          </Button>
          <Button onClick={handleSave} disabled={isSaving} size="sm">
            <Save className="h-4 w-4 mr-2" />
            {isSaving ? 'Saving...' : 'Save'}
          </Button>
        </div>
      </div>

      {/* Main Layout */}
      <div className="flex-1 flex overflow-hidden">
        {/* Block Palette */}
        <div className="w-64 border-r bg-gray-50 overflow-y-auto p-4">
          <BlockPalette onAddBlock={addBlock} />
        </div>

        {/* Canvas */}
        <div className="flex-1 overflow-y-auto bg-gray-100 p-8">
          <div
            className={`mx-auto bg-white shadow-lg transition-all ${
              previewMode === 'mobile' ? 'max-w-[375px]' : 'max-w-4xl'
            }`}
          >
            <DndContext
              sensors={sensors}
              collisionDetection={closestCenter}
              onDragEnd={handleDragEnd}
            >
              <SortableContext
                items={blocks.map(b => b.id)}
                strategy={verticalListSortingStrategy}
              >
                <BuilderCanvas
                  blocks={blocks}
                  selectedBlockId={selectedBlockId}
                  onSelectBlock={setSelectedBlockId}
                  onDeleteBlock={deleteBlock}
                  onDuplicateBlock={duplicateBlock}
                />
              </SortableContext>
            </DndContext>

            {blocks.length === 0 && (
              <div className="p-16 text-center text-muted-foreground">
                <p>Drag blocks from the left panel to start building</p>
              </div>
            )}
          </div>
        </div>

        {/* Block Editor Panel */}
        <div className="w-80 border-l bg-white overflow-y-auto">
          {selectedBlock ? (
            <BlockEditor
              block={selectedBlock}
              onUpdate={(content) => updateBlock(selectedBlock.id, content)}
              onDelete={() => deleteBlock(selectedBlock.id)}
            />
          ) : (
            <div className="p-4 text-center text-muted-foreground">
              <Settings className="h-8 w-8 mx-auto mb-2 opacity-50" />
              <p>Select a block to edit its properties</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

### `components/landing-pages/builder/block-palette.tsx`
```tsx
'use client';

import { Button } from '@/components/ui/button';
import { BLOCK_CONFIGS, BlockType } from './block-types';
import * as Icons from 'lucide-react';

interface BlockPaletteProps {
  onAddBlock: (type: BlockType) => void;
}

export function BlockPalette({ onAddBlock }: BlockPaletteProps) {
  return (
    <div>
      <h3 className="font-semibold mb-4">Add Blocks</h3>
      <div className="space-y-2">
        {BLOCK_CONFIGS.map((config) => {
          const Icon = (Icons as any)[config.icon] || Icons.Square;
          return (
            <button
              key={config.type}
              onClick={() => onAddBlock(config.type)}
              className="w-full flex items-center gap-3 p-3 rounded-lg border bg-white hover:bg-gray-50 hover:border-sage-300 transition-colors text-left"
            >
              <Icon className="h-5 w-5 text-sage-600" />
              <span className="text-sm font-medium">{config.label}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
}
```

### `components/landing-pages/builder/builder-canvas.tsx`
```tsx
'use client';

import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { ContentBlock } from './block-types';
import { BlockRenderer } from './block-renderer';
import { GripVertical, Trash2, Copy } from 'lucide-react';
import { Button } from '@/components/ui/button';

interface SortableBlockProps {
  block: ContentBlock;
  isSelected: boolean;
  onSelect: () => void;
  onDelete: () => void;
  onDuplicate: () => void;
}

function SortableBlock({
  block,
  isSelected,
  onSelect,
  onDelete,
  onDuplicate,
}: SortableBlockProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: block.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      className={`relative group ${
        isSelected ? 'ring-2 ring-sage-500' : ''
      }`}
      onClick={onSelect}
    >
      {/* Block Controls */}
      <div
        className={`absolute -left-12 top-1/2 -translate-y-1/2 flex flex-col gap-1 transition-opacity ${
          isSelected ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'
        }`}
      >
        <button
          {...attributes}
          {...listeners}
          className="p-1.5 rounded bg-white border shadow-sm cursor-grab hover:bg-gray-50"
        >
          <GripVertical className="h-4 w-4 text-gray-400" />
        </button>
        <button
          onClick={(e) => {
            e.stopPropagation();
            onDuplicate();
          }}
          className="p-1.5 rounded bg-white border shadow-sm hover:bg-gray-50"
        >
          <Copy className="h-4 w-4 text-gray-400" />
        </button>
        <button
          onClick={(e) => {
            e.stopPropagation();
            onDelete();
          }}
          className="p-1.5 rounded bg-white border shadow-sm hover:bg-red-50 hover:text-red-500"
        >
          <Trash2 className="h-4 w-4" />
        </button>
      </div>

      {/* Block Content */}
      <BlockRenderer block={block} />
    </div>
  );
}

interface BuilderCanvasProps {
  blocks: ContentBlock[];
  selectedBlockId: string | null;
  onSelectBlock: (id: string) => void;
  onDeleteBlock: (id: string) => void;
  onDuplicateBlock: (id: string) => void;
}

export function BuilderCanvas({
  blocks,
  selectedBlockId,
  onSelectBlock,
  onDeleteBlock,
  onDuplicateBlock,
}: BuilderCanvasProps) {
  return (
    <div className="min-h-[400px] pl-12">
      {blocks
        .sort((a, b) => a.order - b.order)
        .map((block) => (
          <SortableBlock
            key={block.id}
            block={block}
            isSelected={selectedBlockId === block.id}
            onSelect={() => onSelectBlock(block.id)}
            onDelete={() => onDeleteBlock(block.id)}
            onDuplicate={() => onDuplicateBlock(block.id)}
          />
        ))}
    </div>
  );
}
```

### `components/landing-pages/builder/block-renderer.tsx`
```tsx
'use client';

import { ContentBlock } from './block-types';
import { Button } from '@/components/ui/button';

interface BlockRendererProps {
  block: ContentBlock;
  isPreview?: boolean;
}

export function BlockRenderer({ block, isPreview = false }: BlockRendererProps) {
  const { type, content } = block;

  switch (type) {
    case 'hero':
      return (
        <div
          className="relative py-24 px-8"
          style={{
            backgroundImage: content.backgroundImage
              ? `url(${content.backgroundImage})`
              : undefined,
            backgroundSize: 'cover',
            backgroundPosition: 'center',
          }}
        >
          {content.backgroundImage && (
            <div className="absolute inset-0 bg-black/40" />
          )}
          <div
            className={`relative z-10 max-w-3xl mx-auto text-${content.alignment}`}
          >
            <h1 className="text-4xl md:text-5xl font-bold mb-4">
              {content.headline}
            </h1>
            <p className="text-xl mb-8 opacity-90">{content.subheadline}</p>
            <Button size="lg">{content.ctaText}</Button>
          </div>
        </div>
      );

    case 'text':
      return (
        <div
          className={`py-8 px-8 prose max-w-none text-${content.alignment}`}
          dangerouslySetInnerHTML={{ __html: content.content }}
        />
      );

    case 'image':
      return (
        <div className="py-4 px-8">
          {content.src ? (
            <figure>
              <img
                src={content.src}
                alt={content.alt}
                className={`mx-auto ${
                  content.width === 'full' ? 'w-full' : 'max-w-2xl'
                }`}
              />
              {content.caption && (
                <figcaption className="text-center text-sm text-muted-foreground mt-2">
                  {content.caption}
                </figcaption>
              )}
            </figure>
          ) : (
            <div className="aspect-video bg-gray-100 rounded-lg flex items-center justify-center text-muted-foreground">
              Click to add image
            </div>
          )}
        </div>
      );

    case 'cta':
      return (
        <div className="py-8 px-8 text-center">
          <Button
            variant={content.style === 'secondary' ? 'outline' : 'default'}
            size={content.size === 'large' ? 'lg' : 'default'}
          >
            {content.text}
          </Button>
        </div>
      );

    case 'testimonial':
      return (
        <div className="py-12 px-8">
          <blockquote className="max-w-2xl mx-auto text-center">
            <p className="text-xl italic mb-4">"{content.quote}"</p>
            <footer className="flex items-center justify-center gap-3">
              {content.avatar && (
                <img
                  src={content.avatar}
                  alt={content.author}
                  className="w-12 h-12 rounded-full"
                />
              )}
              <div>
                <div className="font-semibold">{content.author}</div>
                <div className="text-sm text-muted-foreground">
                  {content.role}
                </div>
              </div>
            </footer>
          </blockquote>
        </div>
      );

    case 'email_capture':
      return (
        <div className="py-12 px-8 bg-sage-50">
          <div className="max-w-md mx-auto text-center">
            <h3 className="text-2xl font-bold mb-2">{content.headline}</h3>
            <p className="text-muted-foreground mb-4">{content.description}</p>
            <div className="flex gap-2">
              <input
                type="email"
                placeholder="Enter your email"
                className="flex-1 px-4 py-2 rounded-lg border"
                disabled={isPreview}
              />
              <Button>{content.buttonText}</Button>
            </div>
          </div>
        </div>
      );

    case 'quiz_embed':
      return (
        <div className="py-8 px-8">
          <div className="border-2 border-dashed rounded-lg p-8 text-center text-muted-foreground">
            {content.quizId ? (
              <p>Quiz Embed: {content.quizId}</p>
            ) : (
              <p>Select a quiz to embed</p>
            )}
          </div>
        </div>
      );

    case 'product_grid':
      return (
        <div className="py-8 px-8">
          <div className={`grid grid-cols-${content.columns} gap-4`}>
            {Array.from({ length: content.limit }).map((_, i) => (
              <div
                key={i}
                className="aspect-square bg-gray-100 rounded-lg flex items-center justify-center text-muted-foreground"
              >
                Product {i + 1}
              </div>
            ))}
          </div>
        </div>
      );

    case 'faq':
      return (
        <div className="py-8 px-8">
          <h3 className="text-2xl font-bold mb-6 text-center">{content.title}</h3>
          <div className="max-w-2xl mx-auto space-y-4">
            {content.items?.map((item: any, i: number) => (
              <div key={i} className="border rounded-lg p-4">
                <div className="font-semibold">{item.question}</div>
                <div className="text-muted-foreground mt-2">{item.answer}</div>
              </div>
            ))}
          </div>
        </div>
      );

    case 'countdown':
      return (
        <div className="py-8 px-8 text-center">
          <div className="flex justify-center gap-4">
            {['Days', 'Hours', 'Minutes', 'Seconds'].map((unit) => (
              <div key={unit} className="text-center">
                <div className="text-4xl font-bold">00</div>
                <div className="text-sm text-muted-foreground">{unit}</div>
              </div>
            ))}
          </div>
        </div>
      );

    default:
      return (
        <div className="py-4 px-8 text-muted-foreground">
          Unknown block type: {type}
        </div>
      );
  }
}
```

### `components/landing-pages/builder/block-editor.tsx`
```tsx
'use client';

import { ContentBlock, BLOCK_CONFIGS } from './block-types';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Select } from '@/components/ui/select';
import { Button } from '@/components/ui/button';
import { Trash2 } from 'lucide-react';

interface BlockEditorProps {
  block: ContentBlock;
  onUpdate: (content: Record<string, any>) => void;
  onDelete: () => void;
}

export function BlockEditor({ block, onUpdate, onDelete }: BlockEditorProps) {
  const config = BLOCK_CONFIGS.find(c => c.type === block.type);

  const updateField = (key: string, value: any) => {
    onUpdate({ ...block.content, [key]: value });
  };

  const renderFields = () => {
    switch (block.type) {
      case 'hero':
        return (
          <>
            <div>
              <Label>Headline</Label>
              <Input
                value={block.content.headline}
                onChange={(e) => updateField('headline', e.target.value)}
              />
            </div>
            <div>
              <Label>Subheadline</Label>
              <Textarea
                value={block.content.subheadline}
                onChange={(e) => updateField('subheadline', e.target.value)}
              />
            </div>
            <div>
              <Label>CTA Text</Label>
              <Input
                value={block.content.ctaText}
                onChange={(e) => updateField('ctaText', e.target.value)}
              />
            </div>
            <div>
              <Label>CTA Link</Label>
              <Input
                value={block.content.ctaLink}
                onChange={(e) => updateField('ctaLink', e.target.value)}
              />
            </div>
            <div>
              <Label>Alignment</Label>
              <Select
                value={block.content.alignment}
                onChange={(value) => updateField('alignment', value)}
                options={[
                  { value: 'left', label: 'Left' },
                  { value: 'center', label: 'Center' },
                  { value: 'right', label: 'Right' },
                ]}
              />
            </div>
          </>
        );

      case 'text':
        return (
          <>
            <div>
              <Label>Content</Label>
              <Textarea
                value={block.content.content.replace(/<[^>]*>/g, '')}
                onChange={(e) => updateField('content', `<p>${e.target.value}</p>`)}
                rows={6}
              />
            </div>
            <div>
              <Label>Alignment</Label>
              <Select
                value={block.content.alignment}
                onChange={(value) => updateField('alignment', value)}
                options={[
                  { value: 'left', label: 'Left' },
                  { value: 'center', label: 'Center' },
                  { value: 'right', label: 'Right' },
                ]}
              />
            </div>
          </>
        );

      case 'cta':
        return (
          <>
            <div>
              <Label>Button Text</Label>
              <Input
                value={block.content.text}
                onChange={(e) => updateField('text', e.target.value)}
              />
            </div>
            <div>
              <Label>Link URL</Label>
              <Input
                value={block.content.link}
                onChange={(e) => updateField('link', e.target.value)}
              />
            </div>
            <div>
              <Label>Style</Label>
              <Select
                value={block.content.style}
                onChange={(value) => updateField('style', value)}
                options={[
                  { value: 'primary', label: 'Primary' },
                  { value: 'secondary', label: 'Secondary' },
                ]}
              />
            </div>
            <div>
              <Label>Size</Label>
              <Select
                value={block.content.size}
                onChange={(value) => updateField('size', value)}
                options={[
                  { value: 'small', label: 'Small' },
                  { value: 'medium', label: 'Medium' },
                  { value: 'large', label: 'Large' },
                ]}
              />
            </div>
          </>
        );

      case 'testimonial':
        return (
          <>
            <div>
              <Label>Quote</Label>
              <Textarea
                value={block.content.quote}
                onChange={(e) => updateField('quote', e.target.value)}
                rows={4}
              />
            </div>
            <div>
              <Label>Author Name</Label>
              <Input
                value={block.content.author}
                onChange={(e) => updateField('author', e.target.value)}
              />
            </div>
            <div>
              <Label>Role/Title</Label>
              <Input
                value={block.content.role}
                onChange={(e) => updateField('role', e.target.value)}
              />
            </div>
          </>
        );

      case 'email_capture':
        return (
          <>
            <div>
              <Label>Headline</Label>
              <Input
                value={block.content.headline}
                onChange={(e) => updateField('headline', e.target.value)}
              />
            </div>
            <div>
              <Label>Description</Label>
              <Textarea
                value={block.content.description}
                onChange={(e) => updateField('description', e.target.value)}
              />
            </div>
            <div>
              <Label>Button Text</Label>
              <Input
                value={block.content.buttonText}
                onChange={(e) => updateField('buttonText', e.target.value)}
              />
            </div>
          </>
        );

      default:
        return (
          <p className="text-muted-foreground">
            No editable properties for this block type.
          </p>
        );
    }
  };

  return (
    <div className="p-4">
      <div className="flex items-center justify-between mb-4">
        <h3 className="font-semibold">{config?.label || block.type}</h3>
        <Button variant="ghost" size="sm" onClick={onDelete}>
          <Trash2 className="h-4 w-4 text-red-500" />
        </Button>
      </div>

      <div className="space-y-4">{renderFields()}</div>
    </div>
  );
}
```

### `app/(dashboard)/dashboard/campaigns/landing-pages/[id]/edit/page.tsx`
```tsx
'use client';

import { useState, useEffect } from 'react';
import { useParams, useRouter } from 'next/navigation';
import { PageBuilder } from '@/components/landing-pages/builder/page-builder';
import { ContentBlock } from '@/components/landing-pages/builder/block-types';
import { useToast } from '@/hooks/use-toast';

export default function EditLandingPage() {
  const params = useParams();
  const router = useRouter();
  const { toast } = useToast();
  const [isLoading, setIsLoading] = useState(true);
  const [initialBlocks, setInitialBlocks] = useState<ContentBlock[]>([]);
  const [pageSettings, setPageSettings] = useState({});

  useEffect(() => {
    async function loadPage() {
      try {
        const response = await fetch(`/api/landing-pages/${params.id}`);
        if (!response.ok) throw new Error('Failed to load page');
        const page = await response.json();
        setInitialBlocks(page.content?.blocks || []);
        setPageSettings({
          title: page.title,
          slug: page.slug,
          meta_description: page.meta_description,
        });
      } catch (error) {
        toast({
          title: 'Error',
          description: 'Failed to load landing page',
          variant: 'error',
        });
      } finally {
        setIsLoading(false);
      }
    }

    loadPage();
  }, [params.id, toast]);

  const handleSave = async (blocks: ContentBlock[]) => {
    try {
      const response = await fetch(`/api/landing-pages/${params.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          content: { blocks },
        }),
      });

      if (!response.ok) throw new Error('Failed to save');

      toast({
        title: 'Saved',
        description: 'Landing page saved successfully',
      });
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to save landing page',
        variant: 'error',
      });
      throw error;
    }
  };

  if (isLoading) {
    return (
      <div className="h-screen flex items-center justify-center">
        Loading...
      </div>
    );
  }

  return (
    <PageBuilder
      initialBlocks={initialBlocks}
      onSave={handleSave}
      pageSettings={pageSettings}
      onSettingsChange={setPageSettings}
    />
  );
}
```

- **Step Dependencies**: Step 14.3
- **User Instructions**: None

---

